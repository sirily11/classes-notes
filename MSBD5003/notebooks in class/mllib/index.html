
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.1.4">
    
    
      
        <title>Mllib - Class Notes</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.bde7dde4.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ef6f36e2.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("../../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#basic-example-on-transformer-and-estimator" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Class Notes" class="md-header__button md-logo" aria-label="Class Notes" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Class Notes
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Mllib
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Class Notes" class="md-nav__button md-logo" aria-label="Class Notes" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Class Notes
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" data-md-state="indeterminate" type="checkbox" id="__nav_1" checked>
      
      <label class="md-nav__link" for="__nav_1">
        Msbd5006
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Msbd5006" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Msbd5006
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../MSBD5006/Lecture%201/" class="md-nav__link">
        Lecture 1
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../MSBD5006/Lecture%202/" class="md-nav__link">
        Lecture 2
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" data-md-state="indeterminate" type="checkbox" id="__nav_2" checked>
      
      <label class="md-nav__link" for="__nav_2">
        Msbd5012
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Msbd5012" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Msbd5012
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_1" data-md-state="indeterminate" type="checkbox" id="__nav_2_1" checked>
      
      <label class="md-nav__link" for="__nav_2_1">
        Lectures
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Lectures" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_1">
          <span class="md-nav__icon md-icon"></span>
          Lectures
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../MSBD5012/lectures/Lecture%202/" class="md-nav__link">
        Lecture 2
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../MSBD5012/lectures/Lecture1/" class="md-nav__link">
        Lecture1
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../MSBD5012/lectures/Lecture3/" class="md-nav__link">
        Lecture3
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../MSBD5012/lectures/Lecture4/" class="md-nav__link">
        Lecture4
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      <label class="md-nav__link" for="__nav_3">
        Msbd5003
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Msbd5003" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Msbd5003
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Algorithm/" class="md-nav__link">
        Algorithm
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Azure%20Cloud/" class="md-nav__link">
        Azure cloud
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Big%20Data%20and%20HDFS/" class="md-nav__link">
        Big data and hdfs
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../HBase/" class="md-nav__link">
        Hbase
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Lecture3/" class="md-nav__link">
        Lecture3
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../MLib/" class="md-nav__link">
        Mlib
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Spark%20SQL/" class="md-nav__link">
        Spark sql
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Spark%20Streaming/" class="md-nav__link">
        Spark streaming
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Spark%20basics%20and%20RDD/" class="md-nav__link">
        Spark basics and rdd
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../internal/" class="md-nav__link">
        Internal
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_11" data-md-state="indeterminate" type="checkbox" id="__nav_3_11" checked>
      
      <label class="md-nav__link" for="__nav_3_11">
        Projects
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Projects" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_11">
          <span class="md-nav__icon md-icon"></span>
          Projects
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../projects/Project/" class="md-nav__link">
        Project
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_12" type="checkbox" id="__nav_3_12" checked>
      
      <label class="md-nav__link" for="__nav_3_12">
        Notebooks in class
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Notebooks in class" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_12">
          <span class="md-nav__icon md-icon"></span>
          Notebooks in class
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../DC/" class="md-nav__link">
        Dc
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../PMI/" class="md-nav__link">
        Pmi
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../graph/" class="md-nav__link">
        Graph
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../internal/" class="md-nav__link">
        Internal
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Mllib
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Mllib
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#basic-example-on-transformer-and-estimator" class="md-nav__link">
    Basic example on Transformer and Estimator
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pipeline-example" class="md-nav__link">
    Pipeline example
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-analyzing-food-inspection-data-using-logistic-regression" class="md-nav__link">
    Example: Analyzing food inspection data using logistic regression
  </a>
  
    <nav class="md-nav" aria-label="Example: Analyzing food inspection data using logistic regression">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cross-validation" class="md-nav__link">
    Cross-Validation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../rdd/" class="md-nav__link">
        Rdd
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../sparksql/" class="md-nav__link">
        Sparksql
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_13" data-md-state="indeterminate" type="checkbox" id="__nav_3_13" checked>
      
      <label class="md-nav__link" for="__nav_3_13">
        Homeworks
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Homeworks" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_13">
          <span class="md-nav__icon md-icon"></span>
          Homeworks
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../homeworks/HW4/" class="md-nav__link">
        Hw4
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../homeworks/hw1/" class="md-nav__link">
        Hw1
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../homeworks/hw2/" class="md-nav__link">
        Hw2
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../homeworks/hw3/" class="md-nav__link">
        Hw3
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" data-md-state="indeterminate" type="checkbox" id="__nav_4" checked>
      
      <label class="md-nav__link" for="__nav_4">
        Msbd5001
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Msbd5001" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Msbd5001
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../MSBD5001/Lecture%202/" class="md-nav__link">
        Lecture 2
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../MSBD5001/Lecture%203/" class="md-nav__link">
        Lecture 3
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../MSBD5001/Lecture%209/" class="md-nav__link">
        Lecture 9
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../MSBD5001/Lecture1/" class="md-nav__link">
        Lecture1
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../MSBD5001/Lecture4/" class="md-nav__link">
        Lecture4
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../MSBD5001/Lecture6/" class="md-nav__link">
        Lecture6
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_7" data-md-state="indeterminate" type="checkbox" id="__nav_4_7" checked>
      
      <label class="md-nav__link" for="__nav_4_7">
        Project
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Project" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_7">
          <span class="md-nav__icon md-icon"></span>
          Project
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../MSBD5001/project/Copy%20of%20Individual%20Project/" class="md-nav__link">
        Copy of individual project
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../MSBD5001/project/Group%20Project/" class="md-nav__link">
        Group project
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../MSBD5001/project/Individual%20Project/" class="md-nav__link">
        Individual project
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../MSBD5001/project/msbd5001-fall2020/" class="md-nav__link">
        Msbd5001-fall2020
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" data-md-state="indeterminate" type="checkbox" id="__nav_5" checked>
      
      <label class="md-nav__link" for="__nav_5">
        Msbd5008
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Msbd5008" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Msbd5008
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../MSBD5008/Lecture2/" class="md-nav__link">
        Lecture2
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../MSBD5008/Lecture3/" class="md-nav__link">
        Lecture3
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../MSBD5008/Lecture4/" class="md-nav__link">
        Lecture4
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../MSBD5008/Lecture5/" class="md-nav__link">
        Lecture5
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../MSBD5008/Lectyre6/" class="md-nav__link">
        Lectyre6
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_6" data-md-state="indeterminate" type="checkbox" id="__nav_5_6" checked>
      
      <label class="md-nav__link" for="__nav_5_6">
        Homework
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Homework" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_6">
          <span class="md-nav__icon md-icon"></span>
          Homework
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../MSBD5008/homework/homework1/" class="md-nav__link">
        Homework1
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#basic-example-on-transformer-and-estimator" class="md-nav__link">
    Basic example on Transformer and Estimator
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pipeline-example" class="md-nav__link">
    Pipeline example
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-analyzing-food-inspection-data-using-logistic-regression" class="md-nav__link">
    Example: Analyzing food inspection data using logistic regression
  </a>
  
    <nav class="md-nav" aria-label="Example: Analyzing food inspection data using logistic regression">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cross-validation" class="md-nav__link">
    Cross-Validation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Mllib</h1>
                
                <div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">pyspark.ml</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.linalg</span> <span class="kn">import</span> <span class="n">Vectors</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.classification</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.evaluation</span> <span class="kn">import</span> <span class="n">BinaryClassificationEvaluator</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.tuning</span> <span class="kn">import</span> <span class="n">CrossValidator</span><span class="p">,</span> <span class="n">ParamGridBuilder</span>
<span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">Row</span>
<span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pyspark.sql.types</span> <span class="kn">import</span> <span class="o">*</span>
</code></pre></div>

<h2 id="basic-example-on-transformer-and-estimator">Basic example on Transformer and Estimator<a class="headerlink" href="#basic-example-on-transformer-and-estimator" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><code><span class="c1"># Prepare training data from a list of (label, features) tuples.</span>
<span class="c1"># Dense Vectors are just NumPy arrays</span>

<span class="n">training</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">([</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">])),</span>
    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">])),</span>
    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.3</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])),</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">]))],</span> <span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">])</span>
<span class="c1"># Create a LogisticRegression instance. This instance is an Estimator.</span>
<span class="n">lr</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">maxIter</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">regParam</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>

<span class="c1"># Print out the parameters, documentation, and any default values.</span>
<span class="nb">print</span><span class="p">(</span><span class="n">lr</span><span class="o">.</span><span class="n">explainParams</span><span class="p">())</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>aggregationDepth: suggested depth for treeAggregate (&gt;= 2). (default: 2)
elasticNetParam: the ElasticNet mixing parameter, in range [0, 1]. For alpha = 0, the penalty is an L2 penalty. For alpha = 1, it is an L1 penalty. (default: 0.0)
family: The name of family which is a description of the label distribution to be used in the model. Supported options: auto, binomial, multinomial (default: auto)
featuresCol: features column name. (default: features)
fitIntercept: whether to fit an intercept term. (default: True)
labelCol: label column name. (default: label)
lowerBoundsOnCoefficients: The lower bounds on coefficients if fitting under bound constrained optimization. The bound matrix must be compatible with the shape (1, number of features) for binomial regression, or (number of classes, number of features) for multinomial regression. (undefined)
lowerBoundsOnIntercepts: The lower bounds on intercepts if fitting under bound constrained optimization. The bounds vector size must beequal with 1 for binomial regression, or the number oflasses for multinomial regression. (undefined)
maxIter: max number of iterations (&gt;= 0). (default: 100, current: 10)
predictionCol: prediction column name. (default: prediction)
probabilityCol: Column name for predicted class conditional probabilities. Note: Not all models output well-calibrated probability estimates! These probabilities should be treated as confidences, not precise probabilities. (default: probability)
rawPredictionCol: raw prediction (a.k.a. confidence) column name. (default: rawPrediction)
regParam: regularization parameter (&gt;= 0). (default: 0.0, current: 0.01)
standardization: whether to standardize the training features before fitting the model. (default: True)
threshold: Threshold in binary classification prediction, in range [0, 1]. If threshold and thresholds are both set, they must match.e.g. if threshold is p, then thresholds must be equal to [1-p, p]. (default: 0.5)
thresholds: Thresholds in multi-class classification to adjust the probability of predicting each class. Array must have length equal to the number of classes, with values &gt; 0, excepting that at most one value may be 0. The class with largest value p/t is predicted, where p is the original probability of that class and t is the class&#39;s threshold. (undefined)
tol: the convergence tolerance for iterative algorithms (&gt;= 0). (default: 1e-06)
upperBoundsOnCoefficients: The upper bounds on coefficients if fitting under bound constrained optimization. The bound matrix must be compatible with the shape (1, number of features) for binomial regression, or (number of classes, number of features) for multinomial regression. (undefined)
upperBoundsOnIntercepts: The upper bounds on intercepts if fitting under bound constrained optimization. The bound vector size must be equal with 1 for binomial regression, or the number of classes for multinomial regression. (undefined)
weightCol: weight column name. If this is not set or empty, we treat all instance weights as 1.0. (undefined)
</code></pre></div>
<div class="codehilite"><pre><span></span><code><span class="c1"># Learn a LogisticRegression model. This uses the parameters stored in lr.</span>
<span class="n">model1</span> <span class="o">=</span> <span class="n">lr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">training</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">model1</span><span class="p">)</span>
<span class="c1"># model1 is a Model (i.e., a transformer produced by an Estimator)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Model 1&#39;s trained coefficients: &quot;</span><span class="p">,</span> <span class="n">model1</span><span class="o">.</span><span class="n">coefficients</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>LogisticRegressionModel: uid=LogisticRegression_9b20229274e6, numClasses=2, numFeatures=3
Model 1&#39;s trained coefficients:  [-3.10093560102053,2.608214738321436,-0.38017912254302655]
</code></pre></div>
<div class="codehilite"><pre><span></span><code><span class="c1"># We may alternatively specify parameters using a Python dictionary as a paramMap</span>
<span class="n">paramMap</span> <span class="o">=</span> <span class="p">{</span><span class="n">lr</span><span class="o">.</span><span class="n">maxIter</span><span class="p">:</span> <span class="mi">20</span><span class="p">}</span>
<span class="n">paramMap</span><span class="p">[</span><span class="n">lr</span><span class="o">.</span><span class="n">maxIter</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30</span>  <span class="c1"># Specify 1 Param, overwriting the original maxIter.</span>
<span class="n">paramMap</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">lr</span><span class="o">.</span><span class="n">regParam</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">lr</span><span class="o">.</span><span class="n">threshold</span><span class="p">:</span> <span class="mf">0.55</span><span class="p">})</span>  <span class="c1"># Specify multiple Params.</span>

<span class="c1"># You can combine paramMaps, which are python dictionaries.</span>
<span class="n">paramMap</span><span class="p">[</span><span class="n">lr</span><span class="o">.</span><span class="n">probabilityCol</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;myProbability&quot;</span>  <span class="c1"># Change output column name</span>

<span class="c1"># Now learn a new model using the paramMapCombined parameters.</span>
<span class="c1"># paramMapCombined overrides all parameters set earlier via lr.set* methods.</span>
<span class="n">model2</span> <span class="o">=</span> <span class="n">lr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">training</span><span class="p">,</span> <span class="n">paramMap</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Model 2&#39;s trained coefficients: &quot;</span><span class="p">,</span> <span class="n">model2</span><span class="o">.</span><span class="n">coefficients</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>Model 2&#39;s trained coefficients:  [-1.431365881570681,0.4320887101487553,-0.1492041947797477]
</code></pre></div>
<div class="codehilite"><pre><span></span><code><span class="c1"># Prepare test data</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">([</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">dense</span><span class="p">([</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.3</span><span class="p">])),</span>
    <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">])),</span>
    <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">]))],</span> <span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">])</span>

<span class="c1"># Make predictions on test data using the Transformer.transform() method.</span>
<span class="c1"># LogisticRegression.transform will only use the &#39;features&#39; column.</span>
<span class="c1"># Note that model2.transform() outputs a &quot;myProbability&quot; column instead of the usual</span>
<span class="c1"># &#39;probability&#39; column since we renamed the lr.probabilityCol parameter previously.</span>

<span class="n">model1</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">test</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">model2</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">test</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>+---+--------------+--------------------+--------------------+----------+
| id|      features|       rawPrediction|         probability|prediction|
+---+--------------+--------------------+--------------------+----------+
|  1|[-1.0,1.5,1.3]|[-6.5872014439355...|[0.00137599470692...|       1.0|
|  2|[3.0,2.0,-0.1]|[3.98018281942565...|[0.98166040093741...|       0.0|
|  3|[0.0,2.2,-1.5]|[-6.3765177028604...|[0.00169814755783...|       1.0|
+---+--------------+--------------------+--------------------+----------+

+---+--------------+--------------------+--------------------+----------+
| id|      features|       rawPrediction|       myProbability|prediction|
+---+--------------+--------------------+--------------------+----------+
|  1|[-1.0,1.5,1.3]|[-2.8046569418746...|[0.05707304171034...|       1.0|
|  2|[3.0,2.0,-0.1]|[2.49587635664205...|[0.92385223117041...|       0.0|
|  3|[0.0,2.2,-1.5]|[-2.0935249027913...|[0.10972776114779...|       1.0|
+---+--------------+--------------------+--------------------+----------+
</code></pre></div>
<h2 id="pipeline-example">Pipeline example<a class="headerlink" href="#pipeline-example" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><code><span class="c1"># Prepare training documents from a list of (id, text, label) tuples.</span>
<span class="n">training</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">([</span>
    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;a b c d spark spark&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;b d&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;spark f g h&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;hadoop mapreduce&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">],</span> <span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">])</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># A tokenizer converts the input string to lowercase and then splits it by white spaces.</span>
<span class="n">tokenizer</span> <span class="o">=</span> <span class="n">Tokenizer</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;words&quot;</span><span class="p">)</span>
<span class="n">tokenizer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">training</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>+---+-------------------+-----+--------------------+
| id|               text|label|               words|
+---+-------------------+-----+--------------------+
|  0|a b c d spark spark|    1|[a, b, c, d, spar...|
|  1|                b d|    0|              [b, d]|
|  2|        spark f g h|    1|    [spark, f, g, h]|
|  3|   hadoop mapreduce|    0| [hadoop, mapreduce]|
+---+-------------------+-----+--------------------+
</code></pre></div>
<div class="codehilite"><pre><span></span><code><span class="c1"># The same can be achieved by DataFrameAPI:</span>
<span class="c1"># But you will need to wrap it as a transformer to use it in a pipeline.</span>

<span class="n">training</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">split</span><span class="p">(</span><span class="n">training</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">&#39;words&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>+---+-------------------+-----+--------------------+
| id|               text|label|               words|
+---+-------------------+-----+--------------------+
|  0|a b c d spark spark|    1|[a, b, c, d, spar...|
|  1|                b d|    0|              [b, d]|
|  2|        spark f g h|    1|    [spark, f, g, h]|
|  3|   hadoop mapreduce|    0| [hadoop, mapreduce]|
+---+-------------------+-----+--------------------+
</code></pre></div>
<div class="codehilite"><pre><span></span><code><span class="c1"># Maps a sequence of terms to their term frequencies using the hashing trick.</span>
<span class="n">hashingTF</span> <span class="o">=</span> <span class="n">HashingTF</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">getOutputCol</span><span class="p">(),</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;features&quot;</span><span class="p">)</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">hashingTF</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">training</span><span class="p">))</span>
<span class="n">a</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">truncate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;features&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">())</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>+---+-------------------+-----+--------------------------+-----------------------------------------------------------------+
|id |text               |label|words                     |features                                                         |
+---+-------------------+-----+--------------------------+-----------------------------------------------------------------+
|0  |a b c d spark spark|1    |[a, b, c, d, spark, spark]|(262144,[74920,89530,107107,148981,173558],[1.0,1.0,1.0,1.0,2.0])|
|1  |b d                |0    |[b, d]                    |(262144,[89530,148981],[1.0,1.0])                                |
|2  |spark f g h        |1    |[spark, f, g, h]          |(262144,[36803,173558,209078,228158],[1.0,1.0,1.0,1.0])          |
|3  |hadoop mapreduce   |0    |[hadoop, mapreduce]       |(262144,[132966,198017],[1.0,1.0])                               |
+---+-------------------+-----+--------------------------+-----------------------------------------------------------------+

Row(features=SparseVector(262144, {74920: 1.0, 89530: 1.0, 107107: 1.0, 148981: 1.0, 173558: 2.0}))
</code></pre></div>
<div class="codehilite"><pre><span></span><code><span class="c1"># lr is an estimator</span>
<span class="n">lr</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">maxIter</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">regParam</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span>

<span class="c1"># Now we are ready to assumble the pipeline</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">stages</span><span class="o">=</span><span class="p">[</span><span class="n">tokenizer</span><span class="p">,</span> <span class="n">hashingTF</span><span class="p">,</span> <span class="n">lr</span><span class="p">])</span>

<span class="c1"># Fit the pipeline to training documents.</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">training</span><span class="p">)</span>

<span class="c1"># Prepare test documents, which are unlabeled (id, text) tuples.</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">([</span>
    <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;spark i j k&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;l m n&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="s2">&quot;spark hadoop spark&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="s2">&quot;apache hadoop&quot;</span><span class="p">)</span>
<span class="p">],</span> <span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">])</span>

<span class="c1"># Make predictions on test documents and print columns of interest.</span>
<span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">test</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>+---+------------------+--------------------+--------------------+--------------------+--------------------+----------+
| id|              text|               words|            features|       rawPrediction|         probability|prediction|
+---+------------------+--------------------+--------------------+--------------------+--------------------+----------+
|  4|       spark i j k|    [spark, i, j, k]|(262144,[19036,68...|[-0.7500987629692...|[0.32079978124886...|       1.0|
|  5|             l m n|           [l, m, n]|(262144,[1303,526...|[1.58033363406988...|[0.82925176350810...|       0.0|
|  6|spark hadoop spark|[spark, hadoop, s...|(262144,[173558,1...|[-0.7053638244645...|[0.33062407361580...|       1.0|
|  7|     apache hadoop|    [apache, hadoop]|(262144,[68303,19...|[3.95550096961371...|[0.98121072417264...|       0.0|
+---+------------------+--------------------+--------------------+--------------------+--------------------+----------+
</code></pre></div>
<hr />
<h2 id="example-analyzing-food-inspection-data-using-logistic-regression">Example: Analyzing food inspection data using logistic regression<a class="headerlink" href="#example-analyzing-food-inspection-data-using-logistic-regression" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><code><span class="c1"># Data at https://www.cse.ust.hk/msbd5003/data/Food_Inspections1.csv</span>

<span class="n">inspections</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="s1">&#39;../data/Food_Inspections1.csv&#39;</span><span class="p">,</span> <span class="n">inferSchema</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>

<p>Let's take a look at its schema:</p>
<div class="codehilite"><pre><span></span><code><span class="n">inspections</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>root
 |-- _c0: integer (nullable = true)
 |-- _c1: string (nullable = true)
 |-- _c2: string (nullable = true)
 |-- _c3: integer (nullable = true)
 |-- _c4: string (nullable = true)
 |-- _c5: string (nullable = true)
 |-- _c6: string (nullable = true)
 |-- _c7: string (nullable = true)
 |-- _c8: string (nullable = true)
 |-- _c9: integer (nullable = true)
 |-- _c10: string (nullable = true)
 |-- _c11: string (nullable = true)
 |-- _c12: string (nullable = true)
 |-- _c13: string (nullable = true)
 |-- _c14: double (nullable = true)
 |-- _c15: double (nullable = true)
 |-- _c16: string (nullable = true)
</code></pre></div>
<div class="codehilite"><pre><span></span><code><span class="n">inspections</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>+------+--------------------+--------------------+-------+--------------------+---------------+--------------------+-------+---+-----+----------+--------------------+------------------+--------------------+------------------+------------------+--------------------+
|   _c0|                 _c1|                 _c2|    _c3|                 _c4|            _c5|                 _c6|    _c7|_c8|  _c9|      _c10|                _c11|              _c12|                _c13|              _c14|              _c15|                _c16|
+------+--------------------+--------------------+-------+--------------------+---------------+--------------------+-------+---+-----+----------+--------------------+------------------+--------------------+------------------+------------------+--------------------+
|413707|       LUNA PARK INC| LUNA PARK  DAY CARE|2049789|Children&#39;s Servic...|  Risk 1 (High)|  3250 W FOSTER AVE |CHICAGO| IL|60625|09/21/2010|  License-Task Force|              Fail|24. DISH WASHING ...| 41.97583445690982| -87.7107455232781|(41.9758344569098...|
|391234|       CAFE SELMARIE|       CAFE SELMARIE|1069067|          Restaurant|  Risk 1 (High)| 4729 N LINCOLN AVE |CHICAGO| IL|60625|09/21/2010|             Canvass|              Fail|2. FACILITIES TO ...| 41.96740659751604|-87.68761642361608|(41.9674065975160...|
|413751|          MANCHU WOK|MANCHU WOK (T3-H/...|1909522|          Restaurant|  Risk 1 (High)|  11601 W TOUHY AVE |CHICAGO| IL|60666|09/21/2010|             Canvass|              Pass|33. FOOD AND NON-...|42.008536400868735|-87.91442843927047|(42.0085364008687...|
|413708|BENCHMARK HOSPITA...|BENCHMARK HOSPITA...|2049411|          Restaurant|  Risk 1 (High)|325 N LA SALLE ST...|CHICAGO| IL|60654|09/21/2010|Task Force Liquor...|              Pass|                null| 41.88819879207664|-87.63236298373182|(41.8881987920766...|
|413722|           JJ BURGER|           JJ BURGER|2055016|          Restaurant|Risk 2 (Medium)|   749 S CICERO AVE |CHICAGO| IL|60644|09/21/2010|             License|              Pass|                null| 41.87082601444883|-87.74476763884662|(41.8708260144488...|
|413752|GOLDEN HOOKS FISH...|GOLDEN HOOKS FISH...|2042435|          Restaurant|Risk 2 (Medium)|   3958 W MONROE ST |CHICAGO| IL|60624|09/21/2010|Short Form Complaint|              Pass|                null| 41.87987261425607|-87.72551692436804|(41.8798726142560...|
|413714|THE DOCK AT MONTR...|THE DOCK AT MONTR...|2043260|          Restaurant|  Risk 1 (High)|  4400 N SIMONDS DR |CHICAGO| IL|60640|09/21/2010|             License|              Fail|                null| 41.96390893734172|-87.63863624840039|(41.9639089373417...|
|413753|CLARK FOOD &amp; CIGA...|                null|2042203|       Grocery Store|   Risk 3 (Low)|6761 N CLARK ST B...|CHICAGO| IL|60626|09/21/2010|             Canvass|              Pass|                null|  42.0053117273606|-87.67294053846207|(42.0053117273606...|
|120580|          SUSHI PINK|          SUSHI PINK|1847340|          Restaurant|  Risk 1 (High)|909 W WASHINGTON ...|CHICAGO| IL|60607|09/21/2010|             Canvass|              Pass|32. FOOD AND NON-...|41.882987317760424|-87.65014022876997|(41.8829873177604...|
|401216|       M.H.R.,L.L.C.|       M.H.R.,L.L.C.|1621323|          Restaurant|Risk 2 (Medium)|   623 S WABASH AVE |CHICAGO| IL|60605|09/21/2010|             Canvass|   Out of Business|                null| 41.87390845559158|-87.62583770570953|(41.8739084555915...|
|413715|              NABO&#39;S|              NABO&#39;S|1931861|          Restaurant|  Risk 1 (High)|    3351 N BROADWAY |CHICAGO| IL|60657|09/21/2010|Canvass Re-Inspec...|              Pass|19. OUTSIDE GARBA...| 41.94334005547684|-87.64466387044959|(41.9433400554768...|
|413721|THE NICHOLSON SCHOOL|THE NICHOLSON SCHOOL|2002702|Daycare (2 - 6 Ye...|  Risk 1 (High)| 1700 W CORTLAND ST |CHICAGO| IL|60622|09/21/2010|             License|              Pass|                null| 41.91618227133264| -87.6703413842735|(41.9161822713326...|
|401215|       M.H.R.,L.L.C.|       M.H.R.,L.L.C.|1621322|          Restaurant|  Risk 1 (High)| 600 S MICHIGAN AVE |CHICAGO| IL|60605|09/21/2010|             Canvass|   Out of Business|                null| 41.87437161535891|-87.62437952778167|(41.8743716153589...|
|420207|  WHOLE FOODS MARKET|  WHOLE FOODS MARKET|1933690|       Grocery Store|  Risk 1 (High)|1550 N KINGSBURY ST |CHICAGO| IL|60642|09/21/2010|           Complaint|              Pass|32. FOOD AND NON-...| 41.90939878780941|-87.65305069789407|(41.9093987878094...|
|154514|         LAS FUENTES|         LAS FUENTES|  12575|          Restaurant|  Risk 1 (High)|  2558 N HALSTED ST |CHICAGO| IL|60614|09/21/2010|             Canvass|              Fail|18. NO EVIDENCE O...|  41.9290354100918|-87.64903392789199|(41.9290354100918...|
|413711|CASA CENTRAL COMM...|CASA CENTRAL COMM...|  60766|          Restaurant|  Risk 1 (High)|1343 N CALIFORNIA...|CHICAGO| IL|60622|09/21/2010|             License|              Pass|41. PREMISES MAIN...| 41.90598597077873|-87.69680735572291|(41.9059859707787...|
|413764|LA BRUQUENA RESTA...|LA BRUQUENA RESTA...|1492868|          Restaurant|  Risk 1 (High)| 2726 W DIVISION ST |CHICAGO| IL|60622|09/21/2010|Suspected Food Po...|Pass w/ Conditions|4. SOURCE OF CROS...|41.903046386818346|  -87.695535129416|(41.9030463868183...|
|413732|SODEXHO AT UNITED...|SODEXHO AT UNITED...|  20467|          Restaurant|  Risk 1 (High)|  11601 W TOUHY AVE |CHICAGO| IL|60666|09/21/2010|             Canvass|   Out of Business|                null|42.008536400868735|-87.91442843927047|(42.0085364008687...|
|413757|WHIZ KIDS NURSERY...|WHIZ KIDS NURSERY...|1948277|Daycare Above and...|  Risk 1 (High)| 514-522 W 103RD ST |CHICAGO| IL|60628|09/21/2010|             Canvass|              Pass|35. WALLS, CEILIN...|41.707112812685075|-87.63620425242559|(41.7071128126850...|
|363272|FRUTERIA GUAYAUIT...|FRUTERIA GUAYAUIT...|1446823|       Grocery Store|   Risk 3 (Low)|  3849 S KEDZIE AVE |CHICAGO| IL|60632|09/21/2010|             Canvass|   Out of Business|                null| 41.82290845958193|-87.70426021024545|(41.8229084595819...|
+------+--------------------+--------------------+-------+--------------------+---------------+--------------------+-------+---+-----+----------+--------------------+------------------+--------------------+------------------+------------------+--------------------+
only showing top 20 rows
</code></pre></div>
<p>We now have the CSV file as a DataFrame. It has some columns we will not use. Dropping them can save memory when caching the DataFrame. Also, we should give these columns meaningful names.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Drop unused columns and rename interesting columns.</span>

<span class="c1"># Keep interesting columns and rename them to something meaningful</span>

<span class="c1"># Mapping column index to name.</span>
<span class="n">columnNames</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="mi">12</span><span class="p">:</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="mi">13</span><span class="p">:</span> <span class="s2">&quot;violations&quot;</span><span class="p">}</span>

<span class="c1"># Rename column from &#39;_c{id}&#39; to something meaningful.</span>
<span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">inspections</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">columnNames</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">columnNames</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>

<span class="c1"># Drop columns we are not using.</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">inspections</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;violations&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">isNotNull</span><span class="p">())</span>

<span class="n">df</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>
<span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>+------+--------------------+------------------+--------------------+
|    id|                name|           results|          violations|
+------+--------------------+------------------+--------------------+
|413707|       LUNA PARK INC|              Fail|24. DISH WASHING ...|
|391234|       CAFE SELMARIE|              Fail|2. FACILITIES TO ...|
|413751|          MANCHU WOK|              Pass|33. FOOD AND NON-...|
|120580|          SUSHI PINK|              Pass|32. FOOD AND NON-...|
|413715|              NABO&#39;S|              Pass|19. OUTSIDE GARBA...|
|420207|  WHOLE FOODS MARKET|              Pass|32. FOOD AND NON-...|
|154514|         LAS FUENTES|              Fail|18. NO EVIDENCE O...|
|413711|CASA CENTRAL COMM...|              Pass|41. PREMISES MAIN...|
|413764|LA BRUQUENA RESTA...|Pass w/ Conditions|4. SOURCE OF CROS...|
|413757|WHIZ KIDS NURSERY...|              Pass|35. WALLS, CEILIN...|
|154516|TACO &amp; BURRITO PA...|              Pass|30. FOOD IN ORIGI...|
|413759|  MARISCOS EL VENENO|              Pass|18. NO EVIDENCE O...|
|114554|THE HANGGE- UPPE,...|              Pass|18. NO EVIDENCE O...|
|413758|   LINDY&#39;S CHILI INC|Pass w/ Conditions|30. FOOD IN ORIGI...|
|343362|        FUMARE MEATS|              Pass|40. REFRIGERATION...|
|413754|              Subway|              Pass|38. VENTILATION: ...|
|289222|LITTLE CAESARS PIZZA|              Pass|34. FLOORS: CONST...|
|413755|       BILLY&#39;S GRILL|              Pass|33. FOOD AND NON-...|
|343364|             FRESHII|              Fail|18. NO EVIDENCE O...|
|289221|NICKY&#39;S GRILL &amp; Y...|              Pass|33. FOOD AND NON-...|
+------+--------------------+------------------+--------------------+
only showing top 20 rows






10469
</code></pre></div>
<div class="codehilite"><pre><span></span><code><span class="n">df</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>[Row(id=413707, name=&#39;LUNA PARK INC&#39;, results=&#39;Fail&#39;, violations=&#39;24. DISH WASHING FACILITIES: PROPERLY DESIGNED, CONSTRUCTED, MAINTAINED, INSTALLED, LOCATED AND OPERATED - Comments: All dishwashing machines must be of a type that complies with all requirements of the plumbing section of the Municipal Code of Chicago and Rules and Regulation of the Board of Health. OBSEVERD THE 3 COMPARTMENT SINK BACKING UP INTO THE 1ST AND 2ND COMPARTMENT WITH CLEAR WATER AND SLOWLY DRAINING OUT. INST NEED HAVE IT REPAIR. CITATION ISSUED, SERIOUS VIOLATION 7-38-030 H000062369-10 COURT DATE 10-28-10 TIME 1 P.M. ROOM 107 400 W. SURPERIOR. | 36. LIGHTING: REQUIRED MINIMUM FOOT-CANDLES OF LIGHT PROVIDED, FIXTURES SHIELDED - Comments: Shielding to protect against broken glass falling into food shall be provided for all artificial lighting sources in preparation, service, and display facilities. LIGHT SHIELD ARE MISSING UNDER HOOD OF  COOKING EQUIPMENT AND NEED TO REPLACE LIGHT UNDER UNIT. 4 LIGHTS ARE OUT IN THE REAR CHILDREN AREA,IN THE KINDERGARDEN CLASS ROOM. 2 LIGHT ARE OUT EAST REAR, LIGHT FRONT WEST ROOM. NEED TO REPLACE ALL LIGHT THAT ARE NOT WORKING. | 35. WALLS, CEILINGS, ATTACHED EQUIPMENT CONSTRUCTED PER CODE: GOOD REPAIR, SURFACES CLEAN AND DUST-LESS CLEANING METHODS - Comments: The walls and ceilings shall be in good repair and easily cleaned. MISSING CEILING TILES WITH STAINS IN WEST,EAST, IN FRONT AREA WEST, AND BY THE 15MOS AREA. NEED TO BE REPLACED. | 32. FOOD AND NON-FOOD CONTACT SURFACES PROPERLY DESIGNED, CONSTRUCTED AND MAINTAINED - Comments: All food and non-food contact equipment and utensils shall be smooth, easily cleanable, and durable, and shall be in good repair. SPLASH GUARDED ARE NEEDED BY THE EXPOSED HAND SINK IN THE KITCHEN AREA | 34. FLOORS: CONSTRUCTED PER CODE, CLEANED, GOOD REPAIR, COVING INSTALLED, DUST-LESS CLEANING METHODS USED - Comments: The floors shall be constructed per code, be smooth and easily cleaned, and be kept clean and in good repair. INST NEED TO ELEVATE ALL FOOD ITEMS 6INCH OFF THE FLOOR 6 INCH AWAY FORM WALL.  &#39;)]
</code></pre></div>
<p>The output of the above cell gives us an idea of the schema of the input file; the file includes the name of every establishment, the type of establishment, the address, the data of the inspections, and the location, among other things.</p>
<p>Let's start to get a sense of what our dataset contains. For example, what are the different values in the <code>results</code> column?</p>
<div class="codehilite"><pre><span></span><code><span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;results&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>+------------------+
|           results|
+------------------+
|              Fail|
|Pass w/ Conditions|
|              Pass|
+------------------+
</code></pre></div>
<div class="codehilite"><pre><span></span><code><span class="n">df</span><span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s1">&#39;results&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>+------------------+-----+
|           results|count|
+------------------+-----+
|              Fail| 2607|
|Pass w/ Conditions| 1028|
|              Pass| 6834|
+------------------+-----+
</code></pre></div>
<p>Let us develop a model that can guess the outcome of a food inspection, given the violations. Since logistic regression is a binary classification method, it makes sense to group our data into two categories: <strong>Fail</strong> and <strong>Pass</strong>. A "Pass w/ Conditions" is still a Pass, so when we train the model, we will consider the two results equivalent.</p>
<p>Let us go ahead and convert our existing dataframe(<code>df</code>) into a new dataframe where each inspection is represented as a label-violations pair. In our case, a label of 0 represents a failure, a label of 1 represents a success.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># The function to clean the data</span>

<span class="n">labeledData</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">when</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">results</span> <span class="o">==</span> <span class="s1">&#39;Fail&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">results</span> <span class="o">==</span> <span class="s1">&#39;Pass&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">),</span> 
                        <span class="s1">&#39;violations&#39;</span><span class="p">)</span>
<span class="n">labeledData</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>+-----+--------------------+
|label|          violations|
+-----+--------------------+
|    0|24. DISH WASHING ...|
|    0|2. FACILITIES TO ...|
|    1|33. FOOD AND NON-...|
|    1|32. FOOD AND NON-...|
|    1|19. OUTSIDE GARBA...|
|    1|32. FOOD AND NON-...|
|    0|18. NO EVIDENCE O...|
|    1|41. PREMISES MAIN...|
|    1|4. SOURCE OF CROS...|
|    1|35. WALLS, CEILIN...|
|    1|30. FOOD IN ORIGI...|
|    1|18. NO EVIDENCE O...|
|    1|18. NO EVIDENCE O...|
|    1|30. FOOD IN ORIGI...|
|    1|40. REFRIGERATION...|
|    1|38. VENTILATION: ...|
|    1|34. FLOORS: CONST...|
|    1|33. FOOD AND NON-...|
|    0|18. NO EVIDENCE O...|
|    1|33. FOOD AND NON-...|
+-----+--------------------+
only showing top 20 rows
</code></pre></div>
<p>Train a logistic regression model from the input dataframe</p>
<div class="codehilite"><pre><span></span><code><span class="n">trainingData</span><span class="p">,</span> <span class="n">testData</span> <span class="o">=</span> <span class="n">labeledData</span><span class="o">.</span><span class="n">randomSplit</span><span class="p">([</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])</span>

<span class="n">tokenizer</span> <span class="o">=</span> <span class="n">Tokenizer</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;violations&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;words&quot;</span><span class="p">)</span>
<span class="n">hashingTF</span> <span class="o">=</span> <span class="n">HashingTF</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">getOutputCol</span><span class="p">(),</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;features&quot;</span><span class="p">)</span>
<span class="n">lr</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">maxIter</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">regParam</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">stages</span><span class="o">=</span><span class="p">[</span><span class="n">tokenizer</span><span class="p">,</span> <span class="n">hashingTF</span><span class="p">,</span> <span class="n">lr</span><span class="p">])</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">trainingData</span><span class="p">)</span>

<span class="n">predictionsDf</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">testData</span><span class="p">)</span>
<span class="n">predictionsDf</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>+-----+--------------------+--------------------+--------------------+--------------------+--------------------+----------+
|label|          violations|               words|            features|       rawPrediction|         probability|prediction|
+-----+--------------------+--------------------+--------------------+--------------------+--------------------+----------+
|    0|1. SOURCE SOUND C...|[1., source, soun...|(262144,[699,1411...|[8.21045734370492...|[0.99972827746471...|       0.0|
|    0|10. SEWAGE AND WA...|[10., sewage, and...|(262144,[1797,542...|[0.72532689463172...|[0.67377895526181...|       0.0|
|    0|10. SEWAGE AND WA...|[10., sewage, and...|(262144,[2786,610...|[4.76342457489383...|[0.99153592609727...|       0.0|
|    0|12. HAND WASHING ...|[12., hand, washi...|(262144,[1455,278...|[7.50001649481132...|[0.99944723047594...|       0.0|
|    0|13. NO EVIDENCE O...|[13., no, evidenc...|(262144,[284,1797...|[10.5730088915445...|[0.99997440297665...|       0.0|
|    0|13. NO EVIDENCE O...|[13., no, evidenc...|(262144,[2786,610...|[2.06744925670706...|[0.88769893037329...|       0.0|
|    0|16. FOOD PROTECTE...|[16., food, prote...|(262144,[6106,914...|[-1.4603273358789...|[0.18841726515000...|       1.0|
|    0|18. NO EVIDENCE O...|[18., no, evidenc...|(262144,[161,1797...|[1.20630674122104...|[0.76964481719305...|       0.0|
|    0|18. NO EVIDENCE O...|[18., no, evidenc...|(262144,[1797,278...|[0.20311794686958...|[0.55060562031582...|       0.0|
|    0|18. NO EVIDENCE O...|[18., no, evidenc...|(262144,[161,2325...|[4.42895943956892...|[0.98821368031221...|       0.0|
|    0|18. NO EVIDENCE O...|[18., no, evidenc...|(262144,[2786,542...|[4.38608040086412...|[0.98770365203887...|       0.0|
|    0|18. NO EVIDENCE O...|[18., no, evidenc...|(262144,[2786,361...|[2.47491920164261...|[0.92236475183085...|       0.0|
|    0|18. NO EVIDENCE O...|[18., no, evidenc...|(262144,[2325,278...|[2.42852129891198...|[0.91897649882414...|       0.0|
|    0|18. NO EVIDENCE O...|[18., no, evidenc...|(262144,[2786,542...|[2.52500010935656...|[0.92587594231444...|       0.0|
|    0|18. NO EVIDENCE O...|[18., no, evidenc...|(262144,[2786,649...|[11.3588170519728...|[0.99998833396253...|       0.0|
|    0|18. NO EVIDENCE O...|[18., no, evidenc...|(262144,[2786,610...|[4.93010908820459...|[0.99282612140406...|       0.0|
|    0|18. NO EVIDENCE O...|[18., no, evidenc...|(262144,[2786,610...|[2.09044930412383...|[0.88997143023289...|       0.0|
|    0|18. NO EVIDENCE O...|[18., no, evidenc...|(262144,[2786,656...|[4.78228732981419...|[0.99169277163220...|       0.0|
|    0|18. NO EVIDENCE O...|[18., no, evidenc...|(262144,[2325,278...|[5.37386912945687...|[0.99538523611218...|       0.0|
|    0|18. NO EVIDENCE O...|[18., no, evidenc...|(262144,[161,877,...|[-1.4626391002146...|[0.18806401354055...|       1.0|
+-----+--------------------+--------------------+--------------------+--------------------+--------------------+----------+
only showing top 20 rows
</code></pre></div>
<div class="codehilite"><pre><span></span><code><span class="n">numSuccesses</span> <span class="o">=</span> <span class="n">predictionsDf</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s1">&#39;label == prediction&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">numInspections</span> <span class="o">=</span> <span class="n">predictionsDf</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

<span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;There were </span><span class="si">%d</span><span class="s2"> inspections and there were </span><span class="si">%d</span><span class="s2"> successful predictions&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">numInspections</span><span class="p">,</span> <span class="n">numSuccesses</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This is a </span><span class="si">%d%%</span><span class="s2"> success rate&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">numSuccesses</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">numInspections</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">))</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>There were 2131 inspections and there were 1859 successful predictions
This is a 87% success rate
</code></pre></div>
<h3 id="cross-validation">Cross-Validation<a class="headerlink" href="#cross-validation" title="Permanent link">&para;</a></h3>
<p>CrossValidator begins by splitting the dataset into a set of folds which are used as separate training and test datasets. E.g., with k=5 folds, CrossValidator will generate 5 (training, test) dataset pairs, each of which uses 4/5 of the data for training and 1/5 for testing. To evaluate a particular ParamMap, CrossValidator computes the average evaluation metric for the 5 Models produced by fitting the Estimator on the 5 different (training, test) dataset pairs.</p>
<p>After identifying the best ParamMap, CrossValidator finally re-fits the Estimator using the best ParamMap and the entire dataset.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># We now treat the Pipeline as an Estimator, wrapping it in a CrossValidator instance.</span>
<span class="c1"># This will allow us to jointly choose parameters for all Pipeline stages.</span>
<span class="c1"># A CrossValidator requires an Estimator, a set of Estimator ParamMaps, and an Evaluator.</span>
<span class="c1"># We use a ParamGridBuilder to construct a grid of parameters to search over.</span>
<span class="c1"># With 3 values for hashingTF.numFeatures and 2 values for lr.regParam,</span>
<span class="c1"># this grid will have 3 x 2 = 6 parameter settings for CrossValidator to choose from.</span>

<span class="n">paramGrid</span> <span class="o">=</span> <span class="n">ParamGridBuilder</span><span class="p">()</span> \
    <span class="o">.</span><span class="n">addGrid</span><span class="p">(</span><span class="n">hashingTF</span><span class="o">.</span><span class="n">numFeatures</span><span class="p">,</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">])</span> \
    <span class="o">.</span><span class="n">addGrid</span><span class="p">(</span><span class="n">lr</span><span class="o">.</span><span class="n">regParam</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">])</span> \
    <span class="o">.</span><span class="n">build</span><span class="p">()</span>

<span class="n">crossval</span> <span class="o">=</span> <span class="n">CrossValidator</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">pipeline</span><span class="p">,</span>
                          <span class="n">estimatorParamMaps</span><span class="o">=</span><span class="n">paramGrid</span><span class="p">,</span>
                          <span class="n">evaluator</span><span class="o">=</span><span class="n">BinaryClassificationEvaluator</span><span class="p">(),</span>
                          <span class="n">numFolds</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>  

<span class="c1"># Run cross-validation, and choose the best set of parameters.</span>
<span class="n">cvModel</span> <span class="o">=</span> <span class="n">crossval</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">trainingData</span><span class="p">)</span>

<span class="n">predictionsDf</span> <span class="o">=</span> <span class="n">cvModel</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">testData</span><span class="p">)</span>

<span class="n">numSuccesses</span> <span class="o">=</span> <span class="n">predictionsDf</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s1">&#39;label == prediction&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">numInspections</span> <span class="o">=</span> <span class="n">predictionsDf</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

<span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;There were </span><span class="si">%d</span><span class="s2"> inspections and there were </span><span class="si">%d</span><span class="s2"> successful predictions&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">numInspections</span><span class="p">,</span> <span class="n">numSuccesses</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This is a </span><span class="si">%d%%</span><span class="s2"> success rate&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">numSuccesses</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">numInspections</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">))</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>There were 2131 inspections and there were 1909 successful predictions
This is a 89% success rate
</code></pre></div>
<div class="codehilite"><pre><span></span><code><span class="n">cvModel</span><span class="o">.</span><span class="n">explainParams</span><span class="p">()</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>&quot;estimator: estimator to be cross-validated (current: Pipeline_c5b1e2db18ab)\nestimatorParamMaps: estimator param maps (current: [{Param(parent=&#39;HashingTF_7bc1a253c00d&#39;, name=&#39;numFeatures&#39;, doc=&#39;Number of features. Should be greater than 0.&#39;): 10, Param(parent=&#39;LogisticRegression_0a9fda7dc002&#39;, name=&#39;regParam&#39;, doc=&#39;regularization parameter (&gt;= 0).&#39;): 0.1}, {Param(parent=&#39;HashingTF_7bc1a253c00d&#39;, name=&#39;numFeatures&#39;, doc=&#39;Number of features. Should be greater than 0.&#39;): 10, Param(parent=&#39;LogisticRegression_0a9fda7dc002&#39;, name=&#39;regParam&#39;, doc=&#39;regularization parameter (&gt;= 0).&#39;): 0.01}, {Param(parent=&#39;HashingTF_7bc1a253c00d&#39;, name=&#39;numFeatures&#39;, doc=&#39;Number of features. Should be greater than 0.&#39;): 100, Param(parent=&#39;LogisticRegression_0a9fda7dc002&#39;, name=&#39;regParam&#39;, doc=&#39;regularization parameter (&gt;= 0).&#39;): 0.1}, {Param(parent=&#39;HashingTF_7bc1a253c00d&#39;, name=&#39;numFeatures&#39;, doc=&#39;Number of features. Should be greater than 0.&#39;): 100, Param(parent=&#39;LogisticRegression_0a9fda7dc002&#39;, name=&#39;regParam&#39;, doc=&#39;regularization parameter (&gt;= 0).&#39;): 0.01}, {Param(parent=&#39;HashingTF_7bc1a253c00d&#39;, name=&#39;numFeatures&#39;, doc=&#39;Number of features. Should be greater than 0.&#39;): 1000, Param(parent=&#39;LogisticRegression_0a9fda7dc002&#39;, name=&#39;regParam&#39;, doc=&#39;regularization parameter (&gt;= 0).&#39;): 0.1}, {Param(parent=&#39;HashingTF_7bc1a253c00d&#39;, name=&#39;numFeatures&#39;, doc=&#39;Number of features. Should be greater than 0.&#39;): 1000, Param(parent=&#39;LogisticRegression_0a9fda7dc002&#39;, name=&#39;regParam&#39;, doc=&#39;regularization parameter (&gt;= 0).&#39;): 0.01}])\nevaluator: evaluator used to select hyper-parameters that maximize the validator metric (current: BinaryClassificationEvaluator_17036e9cdcf5)\nnumFolds: number of folds for cross validation (default: 3, current: 5)\nseed: random seed. (default: 7809051150349531440)&quot;
</code></pre></div>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        <a href="../internal/" class="md-footer__link md-footer__link--prev" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Internal
            </div>
          </div>
        </a>
      
      
        <a href="../rdd/" class="md-footer__link md-footer__link--next" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Rdd
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../..", "features": ["instant", "navigation.expand"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../../../assets/javascripts/workers/search.4fa0e4ee.min.js", "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.1d3bfcf1.min.js"></script>
      
        <script src="../../../javascripts/config.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="../../../js/expand.js"></script>
      
    
  </body>
</html>